<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mühasibatlıq — Hesabat</title>
<link rel="stylesheet" href="/public/common.css">
<script>
    (function checkAuthGuard() {
        if (!localStorage.getItem('token')) {
            window.location.replace('/public/login.html');
        }
    })();
</script>
<style>
  /* Səhifəyə xas stillər */
  .toolbar{
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 16px;
    padding: 14px;
    border-bottom: 1px solid var(--border);
    align-items: center;
    flex-wrap: wrap;
  }
  .field-group{display:flex;gap:10px;align-items:center}
  
  .grid-kpi{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    padding: 14px;
  }
  .kpi{
    background: #fdfdff;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
  }
  .kpi .label{font-size:12px;color:var(--muted);margin-bottom:6px}
  .kpi .value{font-weight:700;font-size:1.4em; letter-spacing: -0.5px;}
  .kpi.positive .value{color: var(--success);}
  .kpi.negative .value{color: var(--danger);}
  .kpi.warn .value{color: var(--warning);}
  
  .section{padding:14px;border-top:1px solid var(--border)}
  .section h3{margin:0 0 10px 0;font-size:16px}
  .list{display:grid;gap:8px}
  .card-inner{
    border:1px solid var(--border);
    border-radius:12px;
    background:#fdfdff;
    padding:12px;
  }
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:var(--chip);border:1px solid var(--border);font-size:12px;color:var(--muted)}
  .badge.ok{color:#00331e;border-color:#b6e9d8;background:rgba(32,201,151,.08)}
  .badge.warn{color:#543806;border-color:#ffebc2;background:rgba(255,204,102,.08)}
  .badge.err{color:#5e0f0f;border-color:#f8cccc;background:rgba(255,77,79,.08)}
  
  .row-flex{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap; align-items: center;}
  .mono{font-variant-numeric:tabular-nums}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .pill{padding:6px 10px;border-radius:999px;background:#eef4ff;border:1px solid var(--border);font-size:12px;color:var(--muted)}
  .empty{padding:24px;text-align:center;color:var(--muted)}

  /* Filterləri gizlət/göstər */
  .filter-controls { display: none; }
  .filter-controls.active { display: flex; }

  @media(max-width:980px){
    .grid-kpi{grid-template-columns:1fr 1fr}
    .toolbar{grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div id="nav-placeholder"></div>

<div class="container">
  <h1>Mühasibat — Kassa Hesabatı (Başlama Tarixinə görə)</h1>
  <div class="card">
    <div class="toolbar">
      <div class="field-group">
        <label for="periodType">Hesabat Növü:</label>
        <select id="periodType" class="input">
          <option value="day" selected>Günlük (Gün Sonu)</option>
          <option value="month">Aylıq (Ay Sonu)</option>
          <option value="year">İllik (İl Sonu)</option>
        </select>
      </div>

      <div class="field-group" style="flex-grow:1;">
        <div id="filterDayControls" class="filter-controls active">
          <label for="dayFilter">Tarix:</label>
          <input type="date" id="dayFilter" class="input">
        </div>
        
        <div id="filterMonthControls" class="filter-controls">
          <label for="monthFilter">Ay:</label>
          <select id="monthFilter" class="input"></select>
          <label for="yearFilterMonth">İl:</label>
          <select id="yearFilterMonth" class="input"></select>
        </div>
        
        <div id="filterYearControls" class="filter-controls">
          <label for="yearFilter">İl:</label>
          <select id="yearFilter" class="input"></select>
        </div>
      </div>

      <div class="field-group">
        <button class="btn btn-primary" id="printReportBtn">
          Hesabatı Çap Et (PDF)
        </button>
      </div>
    </div>

    <div class="grid-kpi">
      <div class="kpi positive" id="kpiRecognized">
        <div class="label">KASSA MƏDAXİLİ (Real Pul)</div>
        <div class="value mono">0 ₼</div>
      </div>
      <div class="kpi negative" id="kpiTotalExpenses">
        <div class="label">CƏMİ XƏRC (Real Pul)</div>
        <div class="value mono">0 ₼</div>
      </div>
      <div class="kpi positive" id="kpiNet">
        <div class="label">KASSA BALANSI (Mədaxil - Xərc)</div>
        <div class="value mono">0 ₼</div>
      </div>
      <div class="kpi" id="kpiExpected">
        <div class="label">ÜMUMİ QAZANC (Borclar daxil)</div>
        <div class="value mono">0 ₼</div>
      </div>
      <div class="kpi warn" id="kpiPending">
        <div class="label">GÖZLƏMƏDƏ (Ödənilməyən Borclar)</div>
        <div class="value mono">0 ₼</div>
      </div>
    </div>
    <div class="section">
      <h3>Tanınmış Gəlir (Rezervasiyalar)</h3>
      <p class="helper">Bu dövrdə başlayan və tam ödənilmiş bronlar.</p>
      <div class="list" id="listRecognized">
          <div class="empty">Məlumatlar yüklənir...</div>
      </div>
    </div>

    <div class="section">
      <h3>Tanınmış Gəlir (Ödənilmiş Cərimələr)</h3>
      <div class="list" id="listFines">
           <div class="empty">Məlumatlar yüklənir...</div>
      </div>
    </div>

    <div class="section">
      <h3>Tanınmış Gəlir (Digər Mədaxil)</h3>
      <div class="list" id="listIncomes">
           <div class="empty">Məlumatlar yüklənir...</div>
      </div>
    </div>
    
    <div class="section">
      <h3>Gözləmədə Gəlir (Borcu olan bronlar)</h3>
      <p class="helper">Bu dövrdə başlayan və borcu olan bronlar.</p>
      <div class="list" id="listPending">
           <div class="empty">Məlumatlar yüklənir...</div>
      </div>
    </div>

    <div class="section">
      <h3>Gözləmədə Gəlir (Ödənilməyən Cərimələr)</h3>
      <div class="list" id="listPendingFines">
           <div class="empty">Məlumatlar yüklənir...</div>
      </div>
    </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/utc.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/timezone.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isSameOrAfter.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/isSameOrBefore.js"></script>

<script src="/public/nav.js"></script>
<script src="/public/accounting.js"></script>
</body>
</html>